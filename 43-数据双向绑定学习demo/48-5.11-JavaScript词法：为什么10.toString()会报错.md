# JavaScript词法：为什么10.toString()会报错

文法是编译原理中对语言的写法的一种规定，一般来说，文法分成词法和语法两种。  
词法规定了语言的最小语义单元：token；从字符到词的整个过程是没有结构的，只要符合词的规则，就构成词。

## 概述

先学习一下 JavaScript 词法的定义，JavaScript 的输入可以分为：

- WhiteSpace 空白字符
- LineTerminator 换行符
- Comment 注释
- Token 词
  - IdentifierName 标识符名称(如变量名、关键词等)
  - Punctuator 符号，如使用的运算符或大括号等
  - NumericLiteral 数字直接量，如数字
  - StringLiteral 字符串直接量，如单引号或双引号包起来的直接量
  - Template 字符串模板，如反引号`括起来的直接量

这样的设计符合比较通用的编程语言设计方式，不过，JavaScript中有一些不一样的地方；首先，除法和正则表达式冲突问题，大家都知道，在JavaScript中不但支持除法运算符 `/` 和 `/=` 这种形式，还支持用斜杠括起来的正则表达式 `/abc/`；但是，这时候对词法分析来说，它是没有办法处理的，所以 JavaScript 解决方案是定义两组词法，然后靠语法分析传一个标志给词法分析器，最终决定使用哪个方案；JavaScript 词法的另外一个特别设计是字符串模板，模板语法大概是这样：

``` javascript
`this is ${fruitName}`
```

理论上讲，`${}` 内部可以放任何 JavaScript 表达式代码，而这些代码是以 `}` 结尾的，也就是说，这部分词法不允许出现 `}` 运算符；而是否允许 `}` 的两种情况，与除法和正则表达式的两种情况相乘就是四种词法定义，所以在 JavaScript 标准中可以看到四种定义：

- InputElementDiv
- InputElementRegExp
- InputElementExpOrTemplateTail
- InputElementTemplateTail

为了解决这两个问题，标准中还把除法、正则表达式直接量和`}`从 token 中单独抽出来，用词上也把原本的 token 改为了 commonToken。对于一般的语言的词法分析过程来说，都会丢弃除 token 之外的输入，但是在 JavaScript 中不太一样，换行符和注释都会影响语法分析过程。

## 空白字符 WhiteSpace